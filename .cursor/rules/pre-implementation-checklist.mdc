---
description: "Checklist to verify before implementing any feature or fix"
alwaysApply: true
---

# Pre-Implementation Checklist

Before implementing any feature or fix, complete this checklist to avoid common mistakes and ensure successful implementation.

## 1. Understand the System

**Goal**: Understand how the relevant part of the system actually works.

**Tasks**:
- [ ] Read relevant architecture documentation
  - `docs/doc/developer/backend/backend_deepdive.mdx` - [Backend architecture](https://docs.omi.me/doc/developer/backend/backend_deepdive)
  - `docs/doc/developer/backend/StoringConversations.mdx` - [Data storage and flow](https://docs.omi.me/doc/developer/backend/StoringConversations)
  - `docs/doc/developer/backend/chat_system.mdx` - [Chat system architecture](https://docs.omi.me/doc/developer/backend/chat_system)
  - `docs/INDEX.md` - [Complete documentation index](https://docs.omi.me/llms.txt)
  - `ISSUE_TRIAGE_GUIDE.MD` - Omi layers and priorities
- [ ] Read relevant code files
  - Find similar implementations
  - Understand the flow you're modifying
  - Read related functions and modules
- [ ] Understand the data flow
  - How does data move through the system?
  - What are the integration points?
  - What are the dependencies?

**Questions to answer**:
- How does this part of the system currently work?
- What are the key components involved?
- How do similar features work?

## 2. Verify Current State

**Goal**: Ensure functions, APIs, and patterns you plan to use actually exist and are current.

**Tasks**:
- [ ] Search codebase for functions you plan to use
  ```bash
  grep -r "function_name" backend/
  ```
- [ ] Check for deprecation warnings or comments
  - Look for `deprecated`, `TODO`, `FIXME`, `XXX`, `HACK` comments
  - Check recent PRs for changes to these functions
- [ ] Verify APIs and endpoints exist
  - Check router files for endpoint definitions
  - Verify database functions exist
  - Check utility functions are available
- [ ] Check if patterns you want to use are still valid
  - Read recent PRs to see if patterns changed
  - Check for refactoring that might affect your approach

**Red flags**:
- Function not found in codebase
- Deprecation warnings
- Recent PRs that changed similar code
- TODO comments suggesting future changes

## 3. Map to Omi Layers

**Goal**: Understand which layer your change affects and its priority.

**Omi Layers** (from `ISSUE_TRIAGE_GUIDE.MD`):
- **Capture** (Weight: 5) - Audio recording, device pairing, permissions, battery
- **Understand** (Weight: 4) - Speech-to-text, language detection, diarization
- **Memory** (Weight: 4) - Memory creation, syncing, storage, metadata
- **Intelligence** (Weight: 3) - Summaries, insights, action items, reasoning
- **Retrieval/Action** (Weight: 3) - Search, asking Omi, tasks, exports
- **UX/Polish** (Weight: 1) - UI layout, animations, wording
- **Docs/Tooling** (Weight: 1) - Documentation, examples, developer tooling

**Tasks**:
- [ ] Identify which primary layer your change affects
- [ ] Understand the layer's priority and importance
- [ ] Consider impact on memory loop: Capture → Understand → Remember → Retrieve → Act
- [ ] Assess trust impact (data loss, memory corruption = critical)

**Questions**:
- Which layer does this change primarily affect?
- Does this affect memory reliability? (Always high priority)
- What's the trust impact? (Data loss = critical)

## 4. Check Existing Patterns

**Goal**: Find and follow existing patterns rather than creating new ones.

**Tasks**:
- [ ] Search for similar implementations
  - Look for features that do similar things
  - Find code that handles similar cases
- [ ] Study existing patterns
  - How are similar features implemented?
  - What patterns are used?
  - What conventions are followed?
- [ ] Follow established patterns
  - Use same structure as similar code
  - Follow naming conventions
  - Use same error handling patterns

**Questions**:
- How are similar features implemented?
- What patterns should I follow?
- Are there conventions I should use?

## 5. Plan Verification

**Goal**: Define how you'll verify the change works end-to-end.

**Tasks**:
- [ ] Define test scenarios
  - Happy path
  - Error cases
  - Edge cases
  - Integration points
- [ ] Plan end-to-end testing
  - Full flow from start to finish
  - Different states (app open/closed, background/foreground)
  - Different conditions (languages, permissions, etc.)
- [ ] Identify verification tools
  - Test suites to run
  - Linters to check
  - Manual testing steps
- [ ] Plan how to demonstrate it works
  - What evidence will you provide?
  - How will you show it's tested?

**Verification plan should include**:
- [ ] Unit tests (if applicable)
- [ ] Integration tests
- [ ] End-to-end test scenarios
- [ ] Manual testing steps
- [ ] Linter/type checker results
- [ ] Performance benchmarks (if applicable)

## 6. Provide Context Upfront

**Goal**: Include all necessary information in PR description so reviewers don't need to ask.

**PR description should include**:
- [ ] **What changed**: Clear description of changes
- [ ] **Why**: Explanation of the problem and why this solution
- [ ] **How verified**: How you tested and verified it works
- [ ] **Related code**: Links to relevant files and functions
- [ ] **Assumptions**: What you assumed and how you verified
- [ ] **Breaking changes**: Any breaking changes (if applicable)
- [ ] **Testing**: Tests performed and results
- [ ] **Benchmarks**: Performance data (if making performance claims)

**Based on PR #3567 feedback**:
> "show me enough info so that if you were the reviewer, you wouldn't need to ask"

**Example PR description structure**:
```markdown
## Description
Brief description of what changed and why.

## Related Issue
Closes #123

## Changes
- List of specific changes
- Files modified
- New files created

## How I Verified
- End-to-end testing: [describe]
- Test scenarios: [list]
- Manual testing: [steps]
- Linter results: [pass/fail]

## Related Code
- `backend/routers/example.py` - Related endpoint
- `backend/utils/example.py` - Related utility

## Assumptions
- Assumed X, verified by Y
- Checked Z before implementing

## Testing
- [ ] Tests pass
- [ ] Manual testing completed
- [ ] Works in all relevant states
```

## 7. Verify Architecture Compliance

**Goal**: Ensure your implementation follows Omi architecture patterns.

**Tasks**:
- [ ] **Import hierarchy**: Follow database → utils → routers → main
  - Never import from higher levels in lower levels
  - Check all imports follow the hierarchy
- [ ] **Module boundaries**: Respect module boundaries
  - Database layer: Data access only
  - Utils layer: Business logic
  - Routers layer: API endpoints
- [ ] **Memory-first principle**: Don't break memory loop
  - Verify memory capture still works
  - Verify memory storage still works
  - Test memory retrieval
- [ ] **Language settings**: Respect user preferences
  - Check user's language setting
  - Test with multiple languages
  - Don't hardcode English-only behavior

## Checklist Summary

Before starting implementation:

- [ ] ✅ Understand how the system works
- [ ] ✅ Verified functions/APIs exist and are current
- [ ] ✅ Mapped change to Omi layers
- [ ] ✅ Checked existing patterns to follow
- [ ] ✅ Planned verification approach
- [ ] ✅ Prepared PR description with all context
- [ ] ✅ Verified architecture compliance

## Related Rules

- `.cursor/rules/common-mistakes.mdc` - Common mistakes to avoid
- `.cursor/rules/verification.mdc` - Self-checking guidelines
- `.cursor/rules/context-communication.mdc` - Communication best practices
- `.cursor/rules/omi-specific-patterns.mdc` - Omi architecture patterns
- `.cursor/rules/backend-architecture.mdc` - Backend architecture details

## Related Cursor Resources

### Skills
- `.cursor/skills/self-improvement/SKILL.md` - Learn from PRs and issues
- `.cursor/skills/omi-backend-patterns/SKILL.md` - Backend patterns

### Commands
- `/code-review` - Review code before PR
- `/learn-from-pr` - Analyze a PR for lessons
