---
description: "Automatically update documentation when code changes. Triggers when API endpoints, functions, or classes change. Detects changes in backend/routers/, updates API docs, architecture docs, and syncs between .cursor/ and docs/."
globs:
  - "backend/routers/**/*.py"
  - "backend/utils/**/*.py"
  - "backend/database/**/*.py"
  - "app/**/*.dart"
alwaysApply: false
---

# Auto-Documentation Rule

Automatically update documentation when code changes to keep docs in sync with the codebase.

## Purpose

This rule ensures documentation stays current with code changes by automatically detecting modifications and updating relevant documentation files.

## When It Triggers

This rule applies when:
- API endpoints are added, modified, or removed in `backend/routers/`
- Functions or classes are significantly changed
- Architecture changes occur in core modules
- New features are implemented

## Automatic Actions

### API Endpoint Changes

When changes are detected in `backend/routers/**/*.py`:
- Extract endpoint information (method, path, parameters, responses)
- Update `docs/api-reference/endpoint/*.mdx` files (source of truth)
- Update `docs/doc/developer/api/*.mdx` files (source of truth)
- Update `docs/api-reference/openapi.json` if needed
- Generate OpenAPI schema updates if needed

### Architecture Changes

When changes are detected in core modules:
- Update `docs/doc/developer/backend/backend_deepdive.mdx` with new components (source of truth)
- Update `docs/doc/developer/backend/StoringConversations.mdx` if data flows change (source of truth)
- Update `docs/doc/developer/backend/chat_system.mdx` if chat system changes (source of truth)
- Generate or update Mermaid diagrams in `docs/` files

### Function/Class Changes

When functions or classes are significantly changed:
- Extract and update docstrings
- Generate function/class documentation
- Update README files in relevant directories
- Update developer documentation in `docs/doc/developer/`

## Documentation Sync

**The `docs/` folder is the single source of truth for all user-facing documentation, deployed at [docs.omi.me](https://docs.omi.me/).**

- All updates should target `docs/` folder files directly
- Ensure consistency across documentation locations
- Update cross-references and links to match docs.omi.me URLs
- Validate documentation structure matches deployed site

## Workflow

1. **Detect Changes**: Analyze git diff or file changes
2. **Identify Impact**: Determine which documentation needs updating
3. **Generate Updates**: Create or update relevant documentation files
4. **Validate**: Check documentation for completeness and accuracy
5. **Sync**: Ensure all documentation locations are in sync

## Documentation Standards

Follow these standards:
- Use MDX format for `docs/` directory
- Use Markdown for `.cursor/` directory
- Include code examples
- Use Mermaid diagrams for complex flows
- Follow `.cursor/rules/documentation-standards.mdc`

## Related Cursor Resources

### Subagents
- `.cursor/agents/docs-generator.md` - Documentation generation subagent

### Skills
- `.cursor/skills/docs-automation/SKILL.md` - Documentation automation workflows

### Commands
- `/auto-docs` - Trigger automatic documentation update
- `/update-api-docs` - Update API reference documentation
- `/docs` - Generate or update documentation

### Rules
- `.cursor/rules/documentation-standards.mdc` - Documentation standards
- `.cursor/rules/backend-api-patterns.mdc` - API patterns
