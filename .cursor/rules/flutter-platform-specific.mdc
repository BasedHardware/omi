---
description: "Flutter platform-specific code iOS Android macOS Windows CocoaPods Gradle CMake adaptive widgets PlatformManager"
globs:
  - "app/**/*.dart"
alwaysApply: false
references:
  - docs/doc/developer/AppSetup.mdx
  - app/README.md
---

# Flutter Platform-Specific Code

## Platform Detection

### Using Platform Manager

```dart
import 'package:omi/utils/platform/platform_manager.dart';

if (PlatformManager.isIOS) {
  // iOS-specific code
} else if (PlatformManager.isAndroid) {
  // Android-specific code
} else if (PlatformManager.isMacOS) {
  // macOS-specific code
} else if (PlatformManager.isWindows) {
  // Windows-specific code
}
```

### Using Platform Class

```dart
import 'dart:io' show Platform;

if (Platform.isIOS) {
  // iOS code
} else if (Platform.isAndroid) {
  // Android code
} else if (Platform.isMacOS) {
  // macOS code
} else if (Platform.isWindows) {
  // Windows code
}
```

## iOS-Specific

### Configuration

**Location**: `app/ios/`

**Key Files**:
- `Runner/Info.plist` - App configuration
- `Config/Dev/GoogleService-Info.plist` - Firebase (dev)
- `Config/Prod/GoogleService-Info.plist` - Firebase (prod)

### CocoaPods

```bash
cd app/ios
pod install
pod repo update
```

### Xcode Setup

- Open `app/ios` folder in Xcode
- Configure signing in Xcode
- Set bundle identifier
- Configure capabilities (BLE, microphone, etc.)

### iOS-Specific Code

```dart
import 'package:flutter/cupertino.dart';

// Use Cupertino widgets for iOS
CupertinoButton(
  onPressed: () {},
  child: Text('iOS Button'),
)
```

### WatchOS Support

**Location**: `app/ios/omiWatchApp/`

- Apple Watch companion app
- Battery monitoring
- Audio recording interface

## Android-Specific

### Configuration

**Location**: `app/android/`

**Key Files**:
- `app/src/main/AndroidManifest.xml` - App manifest
- `app/src/dev/google-services.json` - Firebase (dev)
- `app/src/prod/google-services.json` - Firebase (prod)

### Gradle Setup

```bash
cd app/android
./gradlew build
```

### Android-Specific Code

```dart
import 'package:flutter/material.dart';

// Use Material widgets for Android
MaterialButton(
  onPressed: () {},
  child: Text('Android Button'),
)
```

### NDK Requirements

- **Required for Opus**: NDK must be installed
- **Version**: NDK 28.2.13676358 (recommended)
- **Installation**: Via Android Studio SDK Manager

## macOS-Specific

### Configuration

**Location**: `app/macos/`

**Key Files**:
- `Runner/Config/Dev/GoogleService-Info.plist` - Firebase (dev)
- `Runner/Config/Prod/GoogleService-Info.plist` - Firebase (prod)

### CocoaPods

```bash
cd app/macos
pod install
```

### macOS-Specific Code

```dart
import 'package:window_manager/window_manager.dart';

// Window management
await windowManager.setMinimumSize(Size(800, 600));
await windowManager.setTitle('Omi');
```

### Desktop Features

- Window management
- System tray integration
- Native menu bars
- Keyboard shortcuts

## Windows-Specific

### Configuration

**Location**: `app/windows/`

**Key Files**:
- `runner/CMakeLists.txt` - Build configuration
- `runner/main.cpp` - Entry point

### CMake Build

```bash
cd app/windows
cmake .
```

### Windows-Specific Code

```dart
// Native Windows audio capture
import 'package:omi/utils/platform/platform_service.dart';

// Use platform service for Windows-specific features
```

### Windows Features

- Native audio capture
- System tray
- Window management
- Floating overlay

## Adaptive Widgets

### Base Adaptive Widget

```dart
import 'package:omi/widgets/base/base_adaptive_widget.dart';

class AdaptiveButton extends BaseAdaptiveWidget {
  @override
  Widget buildIOS(BuildContext context) {
    return CupertinoButton(
      onPressed: onPressed,
      child: Text('iOS Button'),
    );
  }
  
  @override
  Widget buildAndroid(BuildContext context) {
    return MaterialButton(
      onPressed: onPressed,
      child: Text('Android Button'),
    );
  }
  
  @override
  Widget buildMacOS(BuildContext context) {
    return MaterialButton(
      onPressed: onPressed,
      child: Text('macOS Button'),
    );
  }
  
  @override
  Widget buildWindows(BuildContext context) {
    return MaterialButton(
      onPressed: onPressed,
      child: Text('Windows Button'),
    );
  }
}
```

## Platform-Specific Permissions

### iOS Permissions

**Info.plist**:
```xml
<key>NSBluetoothAlwaysUsageDescription</key>
<string>Omi needs Bluetooth to connect to your device</string>
<key>NSMicrophoneUsageDescription</key>
<string>Omi needs microphone access to record audio</string>
<key>NSLocationWhenInUseUsageDescription</key>
<string>Omi uses location for conversation context</string>
```

### Android Permissions

**AndroidManifest.xml**:
```xml
<uses-permission android:name="android.permission.BLUETOOTH" />
<uses-permission android:name="android.permission.BLUETOOTH_SCAN" />
<uses-permission android:name="android.permission.BLUETOOTH_CONNECT" />
<uses-permission android:name="android.permission.RECORD_AUDIO" />
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
```

## Build Configuration

### Flavors

- **dev**: Development backend
- **prod**: Production backend

### Environment Files

- `.env.template` - Template
- `.dev.env` - Development environment
- Production configured via Firebase

## Best Practices

1. **Platform Detection**: Use `PlatformManager` for consistent detection
2. **Adaptive Widgets**: Use `BaseAdaptiveWidget` for platform-specific UI
3. **Testing**: Test on all platforms
4. **Permissions**: Request permissions appropriately per platform
5. **Native Code**: Minimize platform-specific code when possible
6. **Documentation**: Document platform-specific requirements

## Related Documentation

**The `docs/` folder is the single source of truth for all user-facing documentation, deployed at [docs.omi.me](https://docs.omi.me/).**

- **App Setup**: `docs/doc/developer/AppSetup.mdx` - [View online](https://docs.omi.me/doc/developer/AppSetup)
- **Flutter Architecture**: `.cursor/rules/flutter-architecture.mdc`

## Related Cursor Resources

### Rules
- `.cursor/rules/flutter-architecture.mdc` - App structure and patterns
- `.cursor/rules/flutter-localization.mdc` - Localization requirements

### Skills
- `.cursor/skills/omi-flutter-patterns/` - Flutter patterns including platform-specific code

### Subagents
- `.cursor/agents/flutter-developer/` - Flutter development specialist

### Commands
- `/flutter-setup` - Setup platform-specific dependencies
- `/flutter-build` - Build for specific platforms
