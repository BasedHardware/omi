---
description: "Omi codebase architecture overview component relationships backend Flutter firmware web plugins SDKs MCP navigation"
alwaysApply: true
---

# Codebase Overview

## System Architecture

Omi is a multimodal AI wearable platform with the following components:

### Core Components

1. **Backend** (`backend/`) - Python/FastAPI
   - FastAPI REST API and WebSocket server
   - LangGraph agentic chat system
   - Firestore, Pinecone, Redis storage
   - LLM processing and memory extraction

2. **Flutter App** (`app/`) - Dart/Flutter
   - Cross-platform mobile/desktop app
   - BLE device communication
   - Real-time audio streaming
   - State management with Provider

3. **Firmware** (`omi/`, `omiGlass/`) - C/C++
   - nRF chips (Zephyr RTOS) for Omi device
   - ESP32-S3 (Arduino) for Omi Glass
   - BLE services and audio codecs

4. **Web** (`web/`) - Next.js/TypeScript
   - Next.js frontend applications
   - Firebase integration
   - Radix UI / Shadcn/ui components

5. **Plugins** (`plugins/`) - Python/Node.js
   - Integration apps and webhooks
   - Prompt-based apps
   - Chat tools

6. **SDKs** (`sdks/`) - Python/Swift/React Native
   - SDKs for building integrations

7. **MCP Server** (`mcp/`) - Python
   - Model Context Protocol server

## Module Hierarchy

### Backend Hierarchy (strict import order)

1. `database/` - Data access (lowest level)
2. `utils/` - Business logic
3. `routers/` - API endpoints
4. `main.py` - Application entry

**Rule**: Higher-level modules import from lower-level modules, never reverse.

## Key Data Flows

### Conversation Recording
```
Device → BLE → App → WebSocket → Backend → STT → Transcript → LLM → Firestore + Pinecone
```

### Chat Query
```
App → REST API → LangGraph Router → Tools → Context → LLM → Response
```

### Memory Extraction
```
Conversation → LLM → Extract Facts → Firestore (memories collection)
```

## Storage Architecture

- **Firestore**: Primary database (conversations, memories, users)
- **Pinecone**: Vector embeddings for semantic search
- **Redis**: Caching (speech profiles, enabled apps)
- **GCS**: Binary files (audio, photos)

## Development Guidelines

### Backend
- No in-function imports
- Follow module hierarchy
- Free large objects after use
- Use FastAPI patterns

### Flutter
- All user-facing strings use `context.l10n.keyName`
- Use Provider for state management
- Support all platforms (iOS, Android, macOS, Windows)

### Firmware
- Follow Zephyr/Arduino patterns
- Support all codec types (Opus preferred)
- Handle BLE packet fragmentation

## Documentation Structure

**The `docs/` folder is the single source of truth for all user-facing documentation, deployed at [docs.omi.me](https://docs.omi.me/).**

### Public Documentation (docs/ folder)
- **Architecture**: `docs/doc/developer/backend/backend_deepdive.mdx` - [View online](https://docs.omi.me/doc/developer/backend/backend_deepdive)
- **Chat System**: `docs/doc/developer/backend/chat_system.mdx` - [View online](https://docs.omi.me/doc/developer/backend/chat_system)
- **Data Storage**: `docs/doc/developer/backend/StoringConversations.mdx` - [View online](https://docs.omi.me/doc/developer/backend/StoringConversations)
- **API Reference**: `docs/api-reference/` and `docs/doc/developer/api/` - [View online](https://docs.omi.me/api-reference/)
- **Complete Index**: `docs/INDEX.md` - [View online](https://docs.omi.me/llms.txt)

### Internal Cursor Documentation
- **Internal Architecture**: `.cursor/docs/ARCHITECTURE.md` (for Cursor agents only)
- **Internal API Reference**: `.cursor/docs/API_REFERENCE.md` (for Cursor agents only)

## Related Rules

- Backend Architecture: `.cursor/rules/backend-architecture.mdc`
- Flutter Architecture: `.cursor/rules/flutter-architecture.mdc`
- Plugin Development: `.cursor/rules/plugin-development.mdc`

## Codebase Navigation

### Using Semantic Search

For understanding the codebase, use semantic search with natural language questions:
- "How does authentication work in this codebase?"
- "Where is memory extraction handled?"
- "How are WebSocket connections managed?"

See `.cursor/rules/semantic-search.mdc` for effective search strategies.

### Using @ Mentions

For specific references and examples:
- Use `@Files & Folders` to reference specific files or directories
- Use `@Code` to reference specific code sections
- Use `@Docs` to reference documentation

See `.cursor/rules/context-management.mdc` for @ mention best practices.

## Related Cursor Resources

### Skills
- `.cursor/skills/omi-backend-patterns/` - Backend patterns
- `.cursor/skills/omi-flutter-patterns/` - Flutter patterns
- `.cursor/skills/omi-firmware-patterns/` - Firmware patterns
- `.cursor/skills/omi-api-integration/` - API integration
- `.cursor/skills/omi-plugin-development/` - Plugin development
- `.cursor/skills/context-optimization/` - Context management
- `.cursor/skills/diagram-generation/` - Architecture diagrams

### Subagents
- `.cursor/agents/backend-api-developer/` - Backend API development
- `.cursor/agents/backend-llm-engineer/` - LLM integration
- `.cursor/agents/backend-database-engineer/` - Database optimization
- `.cursor/agents/flutter-developer/` - Flutter development
- `.cursor/agents/web-developer/` - Web development
- `.cursor/agents/firmware-engineer/` - Firmware development
- `.cursor/agents/plugin-developer/` - Plugin development
- `.cursor/agents/sdk-developer/` - SDK development

### Commands
- `/backend-setup` - Setup backend
- `/flutter-setup` - Setup Flutter
- `/create-plugin` - Create plugin
- `/create-app` - Create app
- `/semantic-search` - Semantic search guidance
- `/diagram` - Generate architecture diagrams
