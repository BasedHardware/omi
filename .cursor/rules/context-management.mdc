---
description: "Best practices for context management using @ mentions and context window optimization"
alwaysApply: false
references:
  - https://cursor.com/docs/context/mentions
  - https://cursor.com/docs/context/semantic-search
---

# Context Management

Effective context management ensures agents have the right information without overwhelming the context window. Use @ mentions strategically and let agents gather context when appropriate.

## @ Mentions Overview

Cursor supports several @ mention types for adding context:

- **@Files & Folders**: Reference entire files or directories
- **@Code**: Reference specific code sections
- **@Docs**: Reference documentation

## When to Use @ Mentions

### Use @ Mentions When:

1. **Pointing to specific examples**: "Use this pattern from @file.ts"
2. **Referencing related code**: "Similar to @existing-feature.ts"
3. **Providing context files**: "@config.json has the settings"
4. **Cross-referencing**: "This should match @similar-component.tsx"
5. **Documentation**: "@README.md explains the setup"

### Let Agent Gather Context When:

1. **General questions**: "How does X work?" (agent will search)
2. **Broad exploration**: "Find all authentication code"
3. **Discovery tasks**: "Where is Y implemented?"
4. **Understanding flows**: "Show me the data flow"

**Key principle**: Use @ mentions for **specific references**, let agent search for **general exploration**.

## @ Files & Folders

### Referencing Files

**Use for:**
- Specific files you want agent to reference
- Example implementations to follow
- Configuration files
- Related code patterns

**Example:**
```
Use the same pattern as @backend/routers/conversations.py
```

### Referencing Folders

**Use for:**
- Providing directory context
- Showing component structure
- Giving overview of module

**Example:**
```
The @backend/utils/ directory contains business logic
```

**Note**: Large files and folders are automatically condensed to fit context limits.

## @ Code

**Use for:**
- Precise code snippets
- Specific functions or classes
- Targeted code sections
- More granular than @Files

**Example:**
```
Follow the error handling pattern from @Code in utils/errors.py
```

## @ Docs

**Use for:**
- Referencing documentation
- Framework/library docs
- Project documentation

**Available documentation:**
- Popular frameworks (React, Next.js, FastAPI, etc.)
- Custom documentation you've added
- Project docs from `docs/` folder

**Adding custom docs:**
1. Type `@Docs` and select "Add new doc"
2. Paste documentation URL
3. Cursor reads and understands all subpages

## Context Window Management

### Understanding Context Limits

- **Default context**: 200k tokens (varies by model)
- **Max mode**: Up to 1M tokens (for supported models)
- **Context usage**: Shown in chat interface

### Optimization Strategies

1. **Use @ mentions selectively**: Don't attach everything
2. **Let agent search**: Agent can gather context automatically
3. **Reference, don't copy**: Point to files instead of pasting
4. **Break into chunks**: For very large tasks, use multiple conversations
5. **Use Plan Mode**: For complex tasks, create plan first

### Context Condensation

When context window fills:
- Older messages are automatically summarized
- Recent context is preserved
- Agent maintains conversation flow
- Use `/summarize` command to manually condense

## Best Practices

### For Developers

1. **Start without @ mentions**: Let agent search first
2. **Add @ mentions for specific examples**: When you want exact pattern matching
3. **Use @ Docs for external references**: Framework docs, library docs
4. **Reference files, don't paste**: Point to files in codebase
5. **Break large tasks**: Use Plan Mode for complex features

### For Agents

1. **Gather context automatically**: Use semantic search and grep
2. **Ask for @ mentions when needed**: "Can you reference @file.ts?"
3. **Use @ mentions from user**: When user provides specific references
4. **Optimize context usage**: Don't attach unnecessary files
5. **Reference related code**: Use @ mentions to show patterns

## Omi-Specific Patterns

### Backend Development

**Good context:**
- @backend/routers/conversations.py (example pattern)
- @backend/utils/conversations/process_conversation.py (related code)
- @docs/doc/developer/backend/backend_deepdive.mdx (documentation)

**Let agent search:**
- "How does conversation processing work?"
- "Where is memory extraction implemented?"

### Flutter Development

**Good context:**
- @app/lib/services/ble_service.dart (example)
- @app/lib/providers/conversation_provider.dart (pattern)

**Let agent search:**
- "How does BLE connection work?"
- "Where is audio streaming handled?"

### Cross-Component

**Good context:**
- @backend/routers/conversations.py (backend)
- @app/lib/services/conversation_service.dart (Flutter)
- @docs/doc/developer/Protocol.mdx (documentation)

## Context Window Optimization

### Strategies

1. **Use semantic search**: More efficient than attaching large files
2. **Reference instead of copy**: Point to files in codebase
3. **Use Plan Mode**: Break complex tasks into plans
4. **Start new chats**: For unrelated tasks
5. **Use @ mentions strategically**: Only when needed for specific patterns

### Monitoring Context

- Check context gauge in chat input
- Hover to see applied rules
- Use `/summarize` to condense when needed
- Start fresh chat if context is too cluttered

## Related Resources

### Rules
- `.cursor/rules/semantic-search.mdc` - Semantic search strategies
- `.cursor/rules/codebase-overview.mdc` - System architecture
- `.cursor/rules/large-codebase-patterns.mdc` - Large codebase strategies

### Commands
- `/semantic-search` - Semantic search guidance

### Skills
- `.cursor/skills/context-optimization/` - Context management

### Documentation
- [Cursor @ Mentions Docs](https://cursor.com/docs/context/mentions)
- [Cursor Semantic Search](https://cursor.com/docs/context/semantic-search)