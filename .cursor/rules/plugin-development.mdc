---
description: "Omi plugin app development webhook patterns OAuth integration chat tools memory triggers real-time transcript FastAPI Express"
globs:
  - "plugins/**/*.py"
  - "plugins/**/*.js"
alwaysApply: false
references:
  - docs/doc/developer/apps/Introduction.mdx
  - docs/doc/developer/apps/Integrations.mdx
  - docs/doc/developer/apps/ChatTools.mdx
  - plugins/README.md
  - docs/doc/developer/apps/Oauth.mdx
---

# Plugin Development

## Plugin Types

### 1. Prompt-Based Apps
**No server required** - Just define prompts

- Chat prompts: Customize AI personality
- Memory prompts: Customize memory extraction

### 2. Integration Apps
**Requires server endpoint** - Webhook-based

- Memory triggers: Webhook on memory creation
- Real-time transcript: Webhook for live transcripts
- Chat tools: Custom tools for LangGraph
- Audio streaming: Raw audio processing

## Python Plugin Structure

### Basic Plugin

```python
# plugins/example/my_plugin/main.py
from fastapi import FastAPI, Request
from pydantic import BaseModel

app = FastAPI()

class MemoryWebhook(BaseModel):
    id: str
    content: str
    category: str
    user_id: str

@app.post("/webhook/memory-created")
async def memory_created(webhook: MemoryWebhook):
    """Called when a memory is created."""
    # Process memory
    print(f"New memory: {webhook.content}")
    
    # Can create new memories via API
    # Can trigger actions
    # Can send notifications
    
    return {"status": "processed"}
```

### Real-time Transcript Webhook

```python
@app.post("/webhook/transcript")
async def transcript_segment(segment: dict):
    """Called with live transcript segments."""
    text = segment.get("text")
    timestamp = segment.get("timestamp")
    
    # Process in real-time
    if "hey omi" in text.lower():
        # Trigger action
        await trigger_action()
    
    return {"status": "received"}
```

### Chat Tools

```python
from typing import List
from langchain.tools import tool

@tool
def my_custom_tool(query: str) -> str:
    """Description of what this tool does.
    
    Args:
        query: The search query
        
    Returns:
        Results as a string
    """
    # Implement tool logic
    result = perform_search(query)
    return json.dumps(result)

# Register tool in app configuration
CHAT_TOOLS = [my_custom_tool]
```

## JavaScript Plugin Structure

### Basic Plugin

```javascript
// plugins/apps-js/my-plugin/index.js
const express = require('express');
const app = express();

app.use(express.json());

app.post('/webhook/memory-created', async (req, res) => {
  const { id, content, category, user_id } = req.body;
  
  // Process memory
  console.log(`New memory: ${content}`);
  
  // Can call Omi API
  // Can trigger external actions
  
  res.json({ status: 'processed' });
});

app.listen(3000, () => {
  console.log('Plugin running on port 3000');
});
```

## OAuth Integration

### OAuth Setup

```python
from fastapi import FastAPI
from authlib.integrations.fastapi_oauth2 import OAuth2

app = FastAPI()

oauth = OAuth2(
    client_id=os.getenv("CLIENT_ID"),
    client_secret=os.getenv("CLIENT_SECRET"),
    server_metadata_url="https://accounts.google.com/.well-known/openid-configuration",
    client_kwargs={"scope": "openid email profile"},
)

@app.get("/auth")
async def auth():
    return await oauth.google.authorize_redirect(
        redirect_uri="https://your-app.com/callback"
    )

@app.get("/callback")
async def callback(request: Request):
    token = await oauth.google.authorize_access_token(request)
    user_info = token.get("userinfo")
    # Store user info
    return {"status": "authenticated"}
```

## Webhook Security

### Verify Webhook Signature

```python
import hmac
import hashlib

def verify_webhook_signature(payload: bytes, signature: str, secret: str) -> bool:
    """Verify webhook signature."""
    expected_signature = hmac.new(
        secret.encode(),
        payload,
        hashlib.sha256
    ).hexdigest()
    
    return hmac.compare_digest(signature, expected_signature)
```

## Plugin Configuration

### App Manifest

```json
{
  "id": "my-plugin",
  "name": "My Plugin",
  "description": "Plugin description",
  "capabilities": [
    "memory_trigger",
    "real_time_transcript",
    "chat_tools"
  ],
  "webhook_url": "https://your-app.com/webhook",
  "oauth": {
    "provider": "google",
    "client_id": "...",
    "client_secret": "..."
  }
}
```

## Best Practices

1. **Error Handling**: Handle webhook errors gracefully
2. **Idempotency**: Make webhooks idempotent
3. **Rate Limiting**: Implement rate limiting
4. **Logging**: Log all webhook calls
5. **Security**: Verify webhook signatures
6. **Documentation**: Document your plugin API
7. **Testing**: Test with webhook.site first

## Related Documentation

- Plugin Introduction: `docs/doc/developer/apps/Introduction.mdx`
- Integrations: `docs/doc/developer/apps/Integrations.mdx`
- Chat Tools: `docs/doc/developer/apps/ChatTools.mdx`
- OAuth: `docs/doc/developer/apps/Oauth.mdx`

## Related Cursor Resources

### Rules
- `.cursor/rules/plugin-apps-js.mdc` - JavaScript plugin patterns
- `.cursor/rules/backend-api-patterns.mdc` - Backend API patterns
- `.cursor/rules/backend-architecture.mdc` - Backend architecture

### Skills
- `.cursor/skills/omi-plugin-development/` - Plugin development workflows
- `.cursor/skills/omi-api-integration/` - API integration patterns

### Subagents
- `.cursor/agents/plugin-developer/` - Plugin development specialist

### Commands
- `/create-plugin` - Scaffold new plugin structure
- `/create-app` - Scaffold new Omi app
