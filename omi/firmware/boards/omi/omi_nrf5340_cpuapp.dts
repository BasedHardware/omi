/dts-v1/;
#include <nordic/nrf5340_cpuapp_qkaa.dtsi>
#include "omi-pinctrl.dtsi"
#include <zephyr/dt-bindings/sensor/lsm6dso.h>

/ {
	model = "Custom Board auto generated by nRF Connect for VS Code (CPUAPP)";
	compatible = "omi,omi-cpuapp";

	leds {
		compatible = "pwm-leds";
		led_red: led_red {
			label = "Red LED";
			pwms = <&pwm0 2 PWM_USEC(1000) PWM_POLARITY_INVERTED>;
		};
		led_green: led_green {
			label = "Green LED";
			pwms = <&pwm0 1 PWM_USEC(1000) PWM_POLARITY_INVERTED>;
		};
		led_blue: led_blue {
			label = "Blue LED";
			pwms = <&pwm0 0 PWM_USEC(1000) PWM_POLARITY_INVERTED>;
		};
	};
	
	buttons: buttons {
		compatible = "gpio-keys";
		usr_btn: usr-btn {
			gpios = <&gpio0 26 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
			label = "USR";
			zephyr,code = <INPUT_KEY_ENTER>;
		};
	};

	power_pin: power {
		compatible = "nordic,gpio-pins";
		gpios = <&gpio0 5 GPIO_ACTIVE_LOW>;
		status = "okay";
	};

	motor_pin: motor {
		compatible = "nordic,gpio-pins";
		gpios = <&gpio0 25 GPIO_ACTIVE_HIGH>;
		status = "okay";
	};
	
	lsm6dso_en_pin: lsm6dso_en_pin {
		compatible = "nordic,gpio-pins";
		gpios = <&gpio1 12 GPIO_ACTIVE_HIGH>;
		status = "okay";
	};
	
	pdm_en_pin: pdm_en_pin {
		compatible = "nordic,gpio-pins";
		gpios = <&gpio1 4 GPIO_ACTIVE_HIGH>;
		status = "okay";
	};
	
	pdm_thsel_pin: pdm_thsel_pin {
		compatible = "nordic,gpio-pins";
		gpios = <&gpio1 5 GPIO_ACTIVE_HIGH>;
		status = "okay";
	};
	
	pdm_wake_pin: pdm_wake_pin {
		compatible = "nordic,gpio-pins";
		gpios = <&gpio1 2 GPIO_ACTIVE_HIGH>;
		status = "okay";
	};
	
	bat_read_pin: bat_read_pin {
		compatible = "nordic,gpio-pins";
		gpios = <&gpio0 6 GPIO_ACTIVE_HIGH>;
		status = "okay";
	};
	
	bat_chg_pin: bat_chg_pin {
		compatible = "nordic,gpio-pins";
		gpios = <&gpio0 7 GPIO_ACTIVE_HIGH>;
		status = "okay";
	};
	
	flash_mosi_pin: flash-mosi {
		compatible = "nordic,gpio-pins";
		gpios = <&gpio1 9 GPIO_ACTIVE_HIGH>;
		status = "okay";
	};
	
	sdcard_en_pin: sdcard-en {
		compatible = "nordic,gpio-pins";
		gpios = <&gpio1 10 GPIO_ACTIVE_HIGH>;
		status = "okay";
	};

	rfsw_en_pin: rfsw-en {
		compatible = "nordic,gpio-pins";
		gpios = <&gpio1 3 GPIO_ACTIVE_HIGH>;
		status = "okay";
	};

	chosen {
		zephyr,sram = &sram0_image;
		zephyr,flash = &flash0;
		zephyr,code-partition = &slot0_partition;
		zephyr,sram-secure-partition = &sram0_s;
		zephyr,sram-non-secure-partition = &sram0_ns;
		zephyr,console = &uart0;
		zephyr,shell-uart = &uart0;
		zephyr,bt-hci = &bt_hci_ipc0;
		nordic,802154-spinel-ipc = &ipc0;
		zephyr,ieee802154 = &ieee802154;
		zephyr,wifi = &wlan0;
		nordic,pm-ext-flash = &spi_flash;
	};
	aliases {
		dmic0 = &pdm0;
		buttons = &buttons;
	};
};

&gpio0 {
	status = "okay";
	// power_hog {
	// 	gpios = <5 GPIO_ACTIVE_LOW>;
	// 	output-low;
	// 	gpio-hog;
	// };
};

&gpio1 {
    status = "okay";
    sdcard_power_default_on: sdcard_power_default_on {
        gpio-hog;
        gpios = <10 GPIO_ACTIVE_HIGH>; /* Corresponds to sdcard_en_pin P1.10 */
        output-high; /* Set pin high as it's GPIO_ACTIVE_HIGH */
        line-name = "sdcard-power-enable";
    };
};

&gpiote {
	status = "okay";
};

&uart0 {
	status = "okay";
	current-speed = <115200>;
	pinctrl-0 = <&uart0_default>;
	pinctrl-1 = <&uart0_sleep>;
	pinctrl-names = "default", "sleep";
};

&adc {
	status = "okay";
};

&clock {
	hfclkaudio-frequency = <12288000>;
};

&pdm0 {
	status = "okay";
	pinctrl-0 = <&pdm0_default>;
	pinctrl-names = "default";
	clock-source = "PCLK32M_HFXO";
	// #address-cells = < 0x1 >;
	// #size-cells = < 0x0 >;
	// t5838: t5838@0 {
	// 	status = "okay";
	// 	compatible = "invensense,t5838";
	// 	thsel-gpios = <&gpio1 5 GPIO_ACTIVE_HIGH>;
	// 	wake-gpios = <&gpio1 2 GPIO_ACTIVE_HIGH>;
	// 	pdmclk-gpios = <&gpio1 1 GPIO_ACTIVE_HIGH>;
	// 	reg = <0x0>;
	// };
};

&i2c2 {
	status = "okay";
	pinctrl-0 = <&i2c2_default>;
	pinctrl-1 = <&i2c2_sleep>;
	pinctrl-names = "default", "sleep";
	
	lsm6dso: lsm6dso@6a {
		compatible = "st,lsm6dso";
		reg = <0x6a>;
		irq-gpios = <&gpio1 13 GPIO_ACTIVE_HIGH>;
		accel-pm = <LSM6DSO_DT_XL_ULP_MODE>;
		gyro-pm = <LSM6DSO_DT_GY_NORMAL_MODE>;
		status = "okay";
	};
};

&spi3 {
	compatible = "nordic,nrf-spim";
	status = "okay";
	pinctrl-0 = <&spi3_default>;
	pinctrl-1 = <&spi3_sleep>;
	pinctrl-names = "default", "sleep";
	cs-gpios = <&gpio1 11 GPIO_ACTIVE_LOW>, <&gpio0 11 GPIO_ACTIVE_LOW>;
	
	sdhc0: sdhc@0 {
		compatible = "zephyr,sdhc-spi-slot";
		reg = <0>;
		status = "okay";
		mmc {
			compatible = "zephyr,sdmmc-disk";
			status = "okay";
		};
		spi-max-frequency = <24000000>;
	};
	
	spi_flash: p25q16h@1 {
		compatible = "jedec,spi-nor";
		status = "okay";
		reg = <1>;
		spi-max-frequency = <10000000>;
		quad-enable-requirements = "S2B1v1";
		wp-gpios = <&gpio0 19 GPIO_ACTIVE_LOW>;
		hold-gpios= <&gpio0 10 GPIO_ACTIVE_LOW>;
		jedec-id = [85 60 15];
		sfdp-bfp = [
		e5 20 f1 ff  ff ff ff 00  44 eb 08 6b  08 3b 80 bb
		ee ff ff ff  ff ff 00 ff  ff ff 00 ff  0c 20 0f 52
		10 d8 08 81
		];
		size = <DT_SIZE_M(16)>;
		has-dpd;
		t-enter-dpd = <3000>;
		t-exit-dpd = <8000>;
	};
};

&pwm0 {
	status = "okay";
	pinctrl-0 = <&pwm0_default>;
	pinctrl-1 = <&pwm0_sleep>;
	pinctrl-names = "default", "sleep";
};

&qspi {
	pinctrl-0 = <&qspi_default>;
	pinctrl-1 = <&qspi_sleep>;
	pinctrl-names = "default", "sleep";
	status = "okay";
	nrf70: nrf7002@1 {
		compatible = "nordic,nrf7002-qspi";
		status = "okay";
		reg = <1>;
		qspi-frequency = <24000000>;
		qspi-quad-mode;
		#include "nrf70_common.dtsi"
		#include "nrf70_common_5g.dtsi"
	};
};
#include <common/nordic/nrf5340_shared_sram_partition.dtsi>
#include <common/nordic/nrf5340_cpuapp_partition.dtsi>
